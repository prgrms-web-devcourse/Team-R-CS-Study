# 2.3.2 애플리케이션 계층을 처리하는 기기

## L7 스위치

- L7 스위치
    - 애플리케이션 계층
    - `로드밸런서`라고도 한다.
    - 서버의 부하를 분산하는 기기
    - 클라이언트로부터 오는 요청을 여러 서버로 나누는 역할
    - 시스템이 처리할 수 있는 트래픽을 증가시키는 목적을 갖는다.

![2.3.2 Load Balancer.png](image/2.3.2%20Load%20Balancer.png)

- L7 스위치 특징
    - URL, 서버, 캐시, 쿠키를 기반으로 트래픽을 분산한다.
    - 바이러스, 불필요한 외부 데이터 필터링 기능
    - 모든 계층의 프로토콜을 처리할 수 있다.

## L4 스위치

- L4 스위치
    - `전송 계층`
    - 메시지를 기반으로 인식하지 못한다.
    - IP와 PORT를 기반으로 트래픽을 분산한다.

## L7 스위치, L4 스위치 차이

- L4 스위치
    - 패킷을 내용을 확인하지 않는다.
    - 속도가 빠르고 효율이 높다.
    - 데이터 내용 복호화할 필요가 없기 때문에 안전한다.
    - L7 로드밸런서보다 가격이 저렴하다.


- L7 스위치
    - 패킷 내용을 확인한다.
    - 비정상적인 트래픽을 사전에 필터링할 수 있다.
    - 패킷 내용을 복호화해야 한다.
    - L4 로드밸런서에 비해 가격이 비싸다.
    - 상위 계층에서 로드를 분산하기 때문에 더 정교한 라우팅이 가능하다.
    - 캐싱 기능을 제공한다.

## 헬스 체크

- 로드밸런싱 서비스를 제공하는 다수의 서버의 상태를 점검하기 위해 사용되는 기술

- 서버의 상태를 주기적으로 체크하여
  서버의 상태가 통신 불가능한 경우
  서버를 서비스에서 제외하여
  서비스를 원활하게 제공하기 위해 이용된다.


- 헬스 체크 종류
    - Link Health Check
    - ARP Health Check
    - ICMP Health Check
    - TCP Health Check
    - Script Health Check

## 로드밸런서를 이용한 서버 이중화

- 서버의 부하가 균등하게 유지되도록 분산하여 할당한다.


- 네트워크 통신 계층은 7계층으로 나눠지며 상위 계층으로 갈수록 더욱 정교한 로드밸런싱이 가능하다.


- ex) 서버 이중화 이용
    - CD(무중단 배포) - Blue / Green 배포 방식
    - 대기중인 서버를 업데이트하여 대기중인 서버를 배포한다.
    - 대기중인 서버가 현재 서비스 중인 서버가 되고
    - 이전 현재 서비스 중인 서버는 대기중인 서버가 된다.
    - 에러가 발생할 시 업데이트 이전 서버를 향하게 하여 문제를 해결한다.

![2.3.2 Blue-Green-1.png](image/2.3.2%20Blue-Green-1.png)
![2.3.2 Blue-Green-2.png](image/2.3.2%20Blue-Green-2.png)
![2.3.2 Blue-Green-3.png](image/2.3.2%20Blue-Green-3.png)


## 참고

[L4 로드밸런서 vs L7 로드밸런서](https://skstp35.tistory.com/324)
[[L4/L7 스위치] 8. 헬스 체크(Health Check)](https://jesc1249.tistory.com/6)
[[10분 테코톡] 찬, 레넌의 CI/CD와 무중단 배포](https://www.youtube.com/watch?v=sIPU_VkrguI)
